<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta http-equiv="content-type" content="text/html; chatset=UTF-8" />
    <title>Megaman X JS</title>
    <style>
        body {
            background: rgb(47, 149, 197);
        }
        canvas {
            position: absolute;
            top: 0px;
            bottom: 0px;
            left: 0px;
            right: 0px;
            margin: auto;
        }
    </style>
  </head>
  <body>
    <canvas width="800" height="600"></canvas>
    <div>
      <p>X: <span id="posX"></span></p>
      <p>Y: <span id="posY"></span></p>
    </div>
    <script>
      var refX = document.getElementById("posX");
      var refY = document.getElementById("posY");
      (function(window) {
        // Referências no HTML
        var cnv = document.querySelector("canvas");
        var ctx = cnv.getContext("2d");
        //recursos
        var background = new Image();
        background.src = "stage.png";
        var player = new Image();
        player.src = "player.png";
        //objetos
        var sprites = [];
        var gameWorld = {
          img: background,
          x: 0,
          y: 0,
          width: 800,
          height: 600
        };
        sprites.push(gameWorld);
        var char = {
          img: player,
          x: 0,
          y: 0,
          width: 85,
          height: 98,
          gravidade: 0.9,
          velocidade: 0,
          forcaDoPulo:15,

          //gravidade
          atualiza: function() {
            this.velocidade += this.gravidade;
            this.y += this.velocidade;

            if (this.y > 500) {
              this.y = 500
            }  
          },

          //pula


        };
        sprites.push(char);
        //centralizando a o personagem
        var cam = {
          x: 0,
          y: 0,
          width: cnv.width,
          height: cnv.height,
          leftEdge: function() {
            return this.x + this.width * 0.25;
          },
          rightEdge: function() {
            return this.x + this.width * 0.75;
          },
          topEdge: function() {
            return this.y + this.height * 0.25;
          },
          bottomEdge: function() {
            return this.x + this.height * 0.75;
          }
        };
        //centralizando a câmera
        cam.x = (gameWorld.width - cam.width) / 2;
        cam.y = (gameWorld.height - cam.height) / 2;
        // Log de posição inicial
        refX.textContent = char.x;
        refY.textContent = char.y;
        //movendo o jogador
        var mvLeft = (mvRight = mvUp = mvDown = false);
        window.document.addEventListener(
          "keydown",
          function(e) {
            var key = e.keyCode;
            switch (key) {
              case 37:
                mvLeft = true;
                break;
              case 39:
                mvRight = true;
                break;
              case 88:
                mvUp = true;
                break;
              case 40:
                mvDown = true;
                break;
            }
          },
          false
        );
        window.document.addEventListener(
          "keyup",
          function(e) {
            var key = e.keyCode;
            switch (key) {
              case 37:
                mvLeft = false;
                break;
              case 39:
                mvRight = false;
                break;
              case 88:
                mvUp = false;
                break;
              case 40:
                mvDown = false;
                break;
            }
          },
          false
        );
        function pula(event) {
          
        }
        function loop() {
          update();
          render();
          window.requestAnimationFrame(loop);

        }
        function update() {
          if (mvLeft && !mvRight) {
            refX.textContent = char.x;
            char.x -= 4;
          }
          if (mvRight && !mvLeft) {
            refX.textContent = char.x;
            char.x += 4;
          }
          if (mvUp && !mvDown) {
            refY.textContent = char.y;
            char.y -= 4;
          }
          if (mvDown && !mvUp) {
            refY.textContent = char.y;
            char.y += 4;
          }
          //Limite da Câmera
          if (cam.x < 0) {
            cam.x = 0;
          }
          if (cam.x + cam.widght > gameWorld.width) {
            cam.x = gameWorld.width - cam.width;
          }
          if (cam.y < 0) {
            cam.y = 0;
          }
          if (cam.y + cam.height > gameWorld.height) {
            cam.y = gameWorld.height - cam.height;
          }
          //limite do char
          if (char.x < 0) {
            char.x = 0;
          }
          if (char.x + char.width > gameWorld.width) {
            char.x = gameWorld.width - char.width;
          }
          if (char.y < 0) {
            char.y = 0;
          }
          if (char.y + char.height > gameWorld.height) {
            char.y = gameWorld.height - char.height;
          }
          // gravidade 
          char.atualiza()
          // pulo
          document.addEventListener("keyup", pula)
        }
        function render() {
          ctx.save();
          ctx.translate(-cam.x, -cam.y);
          for (var i in sprites) {
            var spr = sprites[i];
            ctx.drawImage(
              spr.img,
              0,
              0,
              spr.width,
              spr.height,
              spr.x,
              spr.y,
              spr.width,
              spr.height
            );
          }
          ctx.restore();
        }
        window.requestAnimationFrame(loop);
      })(window);
    </script>
  </body>
</html>
